<!DOCTYPE html>
<html ng-app="userApp">
<head>
<meta charset="UTF-8">
<title>用戶</title>
<link rel="stylesheet" href="/ineuron/css/bootstrap.min.css">
<script src="/ineuron/js/angular.min.js"></script>
<script src="/ineuron/js/angular-route.min.js"></script>

<script type="text/javascript">
	    //define the package as userApp
		var userApp = angular.module('userApp', ['ngRoute']);
	    
		userApp.config(function($routeProvider) {

	        $routeProvider.

	          when('/list', {

	            templateUrl: '/ineuron/user/list.html',

	            controller: 'UserListController'

	          }).

	          when('/login', {

	            templateUrl: '/ineuron/user/login.html',

	            controller: 'UserLoginController'

	          }).
	          	          
	          when('/register', {

		            templateUrl: '/ineuron/user/register.html',

		            controller: 'UserRegisterCtrl'

		          }).
		          
		      when('/main', {

			        templateUrl: '/ineuron/user/main.html',

			        controller: 'MainController'

			       }).
	          otherwise({

	            redirectTo: '/login'

	          });

	      });
		

		userApp.controller('UserListController', function($scope, $http) {

			$http.get('/user/list').success(function(data) {

				$scope.users = data;

			});
		});
		
		userApp.controller('UserLoginController', function($scope, $http, $location) {
			$scope.submitReg = function(isValid) {
		        $http({
		            url:'/user/authenticate',
		            method: 'POST',            
		            data: {username:$scope.username, password:$scope.password}      
		        }).success(function(data){
		        	alert(data.message);
		        	$location.path("#/main.html");
		            console.log("success!");
		            
		        }).error(function(data){
		        	alert(data.message);
		            console.log("error");
		        })
		    };

			
		});
		
		userApp.controller('UserRegisterCtrl', function($scope, $http, $location) {
			$scope.submitReg = function() {
		        $http({
		            url:'/user/register',
		            method: 'POST',            
		            data: {username:$scope.username, firstname:$scope.firstname, lastname:$scope.lastname, password:$scope.password}      
		        }).success(function(data){
		        	alert(data.message);
		        	$location.path("#/login.html");
		            console.log("success!");
		            
		        }).error(function(data){
		            console.log("error");
		        })
		    };

		});
	</script>

</head>
<body>
	<div ng-view></div>
</body>
</html>